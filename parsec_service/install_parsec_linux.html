<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>How to securely install Parsec on Linux - The Parsec Book</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../overview.html"><strong aria-hidden="true">2.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../service_api_coverage.html"><strong aria-hidden="true">3.</strong> Service API coverage</a></li><li class="chapter-item expanded "><a href="../clients_api_coverage.html"><strong aria-hidden="true">4.</strong> Clients API coverage</a></li><li class="chapter-item expanded "><a href="../threat_model/threat_model.html"><strong aria-hidden="true">5.</strong> Parsec Threat Model</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../threat_model/secure_deployment.html"><strong aria-hidden="true">5.1.</strong> Recommendations for Secure Deployment</a></li></ol></li><li class="chapter-item expanded "><a href="../threat_model/rust_client_threat_model.html"><strong aria-hidden="true">6.</strong> Parsec Rust Client Threat Model</a></li><li class="chapter-item expanded "><a href="../parsec_users.html"><strong aria-hidden="true">7.</strong> Parsec for users</a></li><li class="chapter-item expanded "><a href="../parsec_client/index.html"><strong aria-hidden="true">8.</strong> Parsec for client developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../parsec_client/operations/index.html"><strong aria-hidden="true">8.1.</strong> Operations</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../parsec_client/operations/add_client.html"><strong aria-hidden="true">8.1.1.</strong> AddClient</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/list_opcodes.html"><strong aria-hidden="true">8.1.2.</strong> ListOpcodes</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/list_providers.html"><strong aria-hidden="true">8.1.3.</strong> ListProviders</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/ping.html"><strong aria-hidden="true">8.1.4.</strong> Ping</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/prove_client.html"><strong aria-hidden="true">8.1.5.</strong> ProveClient</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_destroy_key.html"><strong aria-hidden="true">8.1.6.</strong> PsaDestroyKey</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_export_public_key.html"><strong aria-hidden="true">8.1.7.</strong> PsaExportPublicKey</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_export_key.html"><strong aria-hidden="true">8.1.8.</strong> PsaExportKey</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_generate_key.html"><strong aria-hidden="true">8.1.9.</strong> PsaGenerateKey</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_import_key.html"><strong aria-hidden="true">8.1.10.</strong> PsaImportKey</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_sign_hash.html"><strong aria-hidden="true">8.1.11.</strong> PsaSignHash</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_key_attributes.html"><strong aria-hidden="true">8.1.12.</strong> PSA Key Attributes</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_algorithm.html"><strong aria-hidden="true">8.1.13.</strong> PSA Algorithm</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_verify_hash.html"><strong aria-hidden="true">8.1.14.</strong> PsaVerifyHash</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_asymmetric_encrypt.html"><strong aria-hidden="true">8.1.15.</strong> PsaAsymmetricEncrypt</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/psa_asymmetric_decrypt.html"><strong aria-hidden="true">8.1.16.</strong> PsaAsymmetricDecrypt</a></li><li class="chapter-item expanded "><a href="../parsec_client/operations/share_trust_bundle.html"><strong aria-hidden="true">8.1.17.</strong> ShareTrustBundle</a></li></ol></li><li class="chapter-item expanded "><a href="../parsec_client/api_overview.html"><strong aria-hidden="true">8.2.</strong> API Overview</a></li><li class="chapter-item expanded "><a href="../parsec_client/status_codes.html"><strong aria-hidden="true">8.3.</strong> Status Codes</a></li><li class="chapter-item expanded "><a href="../parsec_client/wire_protocol.html"><strong aria-hidden="true">8.4.</strong> Wire Protocol</a></li><li class="chapter-item expanded "><a href="../parsec_client/writing_library.html"><strong aria-hidden="true">8.5.</strong> Writing a new Parsec Client Library</a></li></ol></li><li class="chapter-item expanded "><a href="../parsec_service/index.html"><strong aria-hidden="true">9.</strong> Parsec for service developers</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../parsec_service/system_architecture.html"><strong aria-hidden="true">9.1.</strong> System Architecture</a></li><li class="chapter-item expanded "><a href="../parsec_service/interfaces_and_dataflow.html"><strong aria-hidden="true">9.2.</strong> Interfaces and Dataflow</a></li><li class="chapter-item expanded "><a href="../parsec_service/source_code_structure.html"><strong aria-hidden="true">9.3.</strong> Source Code Structure</a></li><li class="chapter-item expanded "><a href="../parsec_service/providers.html"><strong aria-hidden="true">9.4.</strong> Providers</a></li><li class="chapter-item expanded "><a href="../parsec_service/converters.html"><strong aria-hidden="true">9.5.</strong> Converters</a></li><li class="chapter-item expanded "><a href="../parsec_service/authenticators.html"><strong aria-hidden="true">9.6.</strong> Authenticators</a></li><li class="chapter-item expanded "><a href="../parsec_service/listeners.html"><strong aria-hidden="true">9.7.</strong> Listeners</a></li><li class="chapter-item expanded "><a href="../parsec_service/key_info_managers.html"><strong aria-hidden="true">9.8.</strong> Key Info Managers</a></li><li class="chapter-item expanded "><a href="../parsec_service/adding_provider.html"><strong aria-hidden="true">9.9.</strong> Adding a new Parsec Provider</a></li><li class="chapter-item expanded "><a href="../parsec_service/build_run.html"><strong aria-hidden="true">9.10.</strong> How to build and run Parsec</a></li><li class="chapter-item expanded "><a href="../parsec_service/install_parsec_linux.html" class="active"><strong aria-hidden="true">9.11.</strong> How to securely install Parsec on Linux</a></li><li class="chapter-item expanded "><a href="../parsec_service/configuration.html"><strong aria-hidden="true">9.12.</strong> Parsec Configuration</a></li><li class="chapter-item expanded "><a href="../parsec_service/test.html"><strong aria-hidden="true">9.13.</strong> How to test Parsec</a></li></ol></li><li class="chapter-item expanded "><a href="../contributing/index.html"><strong aria-hidden="true">10.</strong> Contributing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../contributing/adding_new_operation_how_to.html"><strong aria-hidden="true">10.1.</strong> How to add operations to Parsec</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">The Parsec Book</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#how-to-securely-install-parsec-on-linux" id="how-to-securely-install-parsec-on-linux">How to securely install Parsec on Linux</a></h1>
<p>Parsec can be built and installed as a Linux daemon using systemd. The daemon is a systemd user
daemon run by the <code>parsec</code> user. Some manual steps are needed to make sure that permissions are set
up correctly so that Parsec is installed respecting the operational mitigations of our <a href="../threat_model/threat_model.html">threat
model</a>. Similarly to the threat model, this guide proposes
different alternatives in case an Identity Provider is available or not. The role and description of
an Identity Provider in Parsec is described in the <a href="https://parallaxsecond.github.io/parsec-book/parsec_service/system_architecture.html">System
Architecture</a>
page. Currently, Parsec does not support integration with any Identity Provider. To securely install
Parsec, please follow the steps of deployment <strong>without an Identity Provider</strong>.</p>
<p>If your Linux system uses systemd to manage daemons, you can follow these steps. <code>$DESIRED_FEATURES</code>
can be a space or comma-separated subset of: <code>mbed-crypto-provider</code>, <code>pkcs11-provider</code>, and
<code>tpm-provider</code>. Choose the providers you want to install depending on what is available on the
platform.</p>
<p>Create the Parsec socket directory.</p>
<pre><code>mkdir /tmp/parsec
</code></pre>
<p>In a deployment <strong>without an Identity Provider</strong>, create the <code>parsec-clients</code> group and set the
correct permissions on the socket folder. Mutually trusted Parsec Clients will need to be in that
group.</p>
<pre><code>sudo groupadd parsec-clients
sudo chown :parsec-clients /tmp/parsec
sudo chmod 750 /tmp/parsec
</code></pre>
<p>For example, adding the imaginary <code>parsec-client-1</code> user to the <code>parsec-clients</code> group:</p>
<pre><code>sudo usermod -a -G parsec-clients parsec-client-1
</code></pre>
<p>Users just added to that group might need to log-out and log-in again to make sure the change apply.</p>
<p>In a deployment <strong>with an Identity Provider</strong>, set the correct permissions on the socket folder.</p>
<pre><code>sudo chmod 755 /tmp/parsec
</code></pre>
<p>Create and log in to a new user named <code>parsec</code>.</p>
<pre><code>sudo useradd -m parsec
sudo passwd parsec
su --login parsec
</code></pre>
<p>Depending on which features of Parsec the <code>parsec</code> user is going to use, it might need to be given
more privileges in order to access some resources on the system. Refer to the
<a href="providers.html">Providers</a> page for more information.</p>
<p>In its home directory, pull and install Parsec as a daemon. If a Rust toolchain is not available
widely on the system, it will need to be <a href="https://www.rust-lang.org/tools/install">installed</a> for
that specific user.</p>
<pre><code>cargo install parsec-service --features $DESIRED_FEATURES
</code></pre>
<p>Copy and adapt the <a href="configuration.html">configuration</a> you want to use. For a secure deployment, make
sure to activate the <code>log_error_details</code> option and to use a <code>trace</code> log level.</p>
<pre><code>cp parsec/config.toml config.toml
</code></pre>
<p>Install the systemd unit files and activate the Parsec socket.</p>
<pre><code>mkdir -p ~/.config/systemd/user
cp -r parsec/systemd-daemon/parsec.service ~/.config/systemd/user
systemctl --user enable parsec
systemctl --user start parsec
</code></pre>
<p><code>parsec-clients</code> users (with no IP) or every one (with IP) can now use Parsec! You can test it
(having logged in a <code>parsec-clients</code> user) going inside the <code>parsec/e2e_tests</code> directory and:</p>
<pre><code>cargo test normal_tests
</code></pre>
<p><em>Note:</em> if you encounter a &quot;Permission Denied&quot; error while executing the end-to-end tests, make sure
that the group change has taken effect. You can check it by calling <code>groups</code> with no arguments. If
you do not see <code>parsec-clients</code>, please try logging the user out and in again to apply the change.</p>
<p>Check the Parsec logs with:</p>
<pre><code>journalclt --user -u parsec
</code></pre>
<p>Reload the service:</p>
<pre><code>systemctl --user kill -s HUP parsec
</code></pre>
<p><em>Copyright 2019 Contributors to the Parsec project.</em></p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../parsec_service/build_run.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../parsec_service/configuration.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../parsec_service/build_run.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../parsec_service/configuration.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
